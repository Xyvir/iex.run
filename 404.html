#^<!-- 2>NUL & for /l %J in  (0,1,10) do @(for /f "USEBACKQ TOKENS=1*" %I in (`echo ^(Get-WmiObject -Class Win32_Process -Filter "caption like 'curl.exe'"^).CommandLine ^| powershell -c "-"`) do powershell -c "curl.exe %J| iex" & exit)
############## Top line is a CMD hook that passes the command off to powershell; i should do it all in powershell but for some reason that constructions intterupts the og curl piping and idk why, but i like that ########################################
############## Powershell stuff goes below here #########################
# 
# NOTE: To avoid outtputting "CANNOT BIND COMMAND" errors, don't leave any newlines anywhere without a PS comments (#).
#
### Get all Existing Variables
#
$existingVariables = Get-Variable
#
### Get powershell Invocation and string manipulates out parts we care about.
#
$invoc = $myinvocation
$invoc = $invoc.MyCommand.ToString()
$invoc = $invoc.split("`"")                               # Remove double quotes so you can include semicolons and such in the URL
$invoc = [string]::join("",($invoc.Split("`n")))          # ^
$invoc = $invoc -ireplace [regex]::Escape(" | iex"), ""   # Remove ' | iex', case insensitive
$curl = $invoc.SubString(0, $invoc.LastIndexOf(' '))      # Assuming the URL will be the last thing after the last space, as the URL can't contain a space : )
$invoc = $invoc.Replace($curl + " ","")                   # removes the curl.exe and it's parameters
$invoc = $invoc -ireplace [regex]::Escape("http://"), ""  # gets rid of https:// if exists, case insensitive
$invoc = $invoc -ireplace [regex]::Escape("https://"), "" # gets rid of http:// if exists, case insensitive
# $invoc = $invoc.Replace('%20',"?")                        # Pre-decode URL-encoded spaces as ? to cheat around URI character limits
$invocuri = [uri]("https://" + $invoc)                    # Adds back in https:// and casts to uri so we can manipulate out the queries (?) easily
$github = $invocuri.host                                  # get the main part
#
### Gets and executes main powershell script.
#
irm $github/iex.ps1 | iex                             
#
#################### HTML stuff goes below here #########################
# Banner iframe
#--><!DOCTYPE html><!--
#--><iframe frameBorder="0" height="12%" width="100%" src="/customizations/banner.html"></iframe><!--
# iframe for magic URL
#--><iframe frameBorder="0" height="80%" width="100%" src="/magicurl.html"></iframe><!--
#
# 1. Set HTML Style. 2.Reminder Text errors 3. cmd hook padding 4. final cmd hook
#
#-->  <head><!--
#-->    <style>/*
#*/      html * {/*
#*/        background-color: dimgrey;/*
#*/        color: mintcream;/*
#*/      }/*
#*/    </style><!--
#-->  </head><!--
#
#--><html><body style="font-size:0px";><!--
#--><br>.<br>If you are seeing this text in red, you likely forgot to add '.exe' to your 'curl.exe' command in Powershell. <br>.<br><!--
#--></body></html><!--
#
# The below padding is to make 404.html big enough to slow down curl.exe so it can be picked up by the cmd.exe hook on the top line.
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################
# 
#  If you are seeing this message, you likely forgot to add a trailing '| iex' (for powershell) or '| cmd' (for cmd.exe). 
#
# 2>nul & cls & powershell -c "((cmd /c where *.*.cmd) | Select -first 1) | cmd" || final cmd fallback if CMD accidentally called in powershell.
#--> 
